<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Session Check</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container mt-5">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3>üîç Debug Session & Authentication</h3>
            </div>
            <div class="card-body">
                <h5>Session Storage Check:</h5>
                <pre id="sessionData" class="bg-light p-3 border"></pre>

                <hr>

                <h5>Test Actions:</h5>
                <div class="btn-group" role="group">
                    <button class="btn btn-success" onclick="testLogin()">Test Login (Admin)</button>
                    <button class="btn btn-warning" onclick="checkSession()">Check Session</button>
                    <button class="btn btn-danger" onclick="clearSession()">Clear Session</button>
                    <button class="btn btn-info" onclick="goToStok()">Go to Stok Page</button>
                </div>

                <hr>

                <h5>Console Logs:</h5>
                <div id="logs" class="bg-dark text-white p-3" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/dataBahanAjar.js"></script>
    <script src="js/index.js"></script>

    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            const color = {
                'info': 'text-info',
                'success': 'text-success',
                'error': 'text-danger',
                'warning': 'text-warning'
            }[type] || 'text-white';

            logsDiv.innerHTML += `<div class="${color}">[${time}] ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        function testLogin() {
            log('Testing login with admin credentials...', 'info');
            const adminUser = dataPengguna.find(u => u.email === 'admin@ut.ac.id');

            if (adminUser) {
                sessionStorage.setItem('currentUser', JSON.stringify(adminUser));
                log('‚úÖ Login successful! User data saved to sessionStorage', 'success');
                checkSession();
            } else {
                log('‚ùå Admin user not found in dataPengguna', 'error');
            }
        }

        function checkSession() {
            log('Checking sessionStorage...', 'info');
            const currentUser = sessionStorage.getItem('currentUser');
            const sessionDataEl = document.getElementById('sessionData');

            if (currentUser) {
                const userData = JSON.parse(currentUser);
                sessionDataEl.textContent = JSON.stringify(userData, null, 2);
                log('‚úÖ User is logged in: ' + userData.nama, 'success');
                log('isLoggedIn() = ' + (typeof isLoggedIn !== 'undefined' ? isLoggedIn() : 'function not found'), 'info');
            } else {
                sessionDataEl.textContent = 'No user data in sessionStorage';
                log('‚ùå No user logged in', 'warning');
            }
        }

        function clearSession() {
            log('Clearing sessionStorage...', 'warning');
            sessionStorage.removeItem('currentUser');
            checkSession();
            log('‚úÖ Session cleared', 'success');
        }

        function goToStok() {
            log('Navigating to stok.html...', 'info');
            if (isLoggedIn()) {
                log('‚úÖ User is logged in, redirecting...', 'success');
                setTimeout(() => {
                    window.location.href = 'stok.html';
                }, 500);
            } else {
                log('‚ùå User not logged in! Please login first.', 'error');
                alert('Please login first using "Test Login" button');
            }
        }

        // Check on page load
        window.addEventListener('DOMContentLoaded', function () {
            log('=== Debug Page Loaded ===', 'success');
            log('Checking dependencies...', 'info');
            log('dataPengguna exists: ' + (typeof dataPengguna !== 'undefined'), 'info');
            log('dataBahanAjarSource exists: ' + (typeof dataBahanAjarSource !== 'undefined'), 'info');
            log('isLoggedIn function exists: ' + (typeof isLoggedIn !== 'undefined'), 'info');
            log('getCurrentUser function exists: ' + (typeof getCurrentUser !== 'undefined'), 'info');
            checkSession();
        });
    </script>
</body>

</html>